<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="FPWHdyBDD6jevLuW5oFDPqoeCkmXxYTpLezJ_qISKeE" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Code help, tutorials, guides, tips">
    <meta name="keywords"  content="code base camp codebase camp basecamp programming tutorial help guides iOS xCode Swift Android Java">
    <meta name="theme-color" content="#000000">

    <title>iOS Expandable Table View Cells - Coding Guides, Tutorials and Help | CodeBaseCamp</title>

    <!-- Web App Manifest -->
    <link rel="manifest" href="/pwa/manifest.json">

    <!-- Favicon -->
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="../img/favicon/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../img/favicon/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../img/favicon/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../img/favicon/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="../img/favicon/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../img/favicon/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="../img/favicon/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../img/favicon/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="../img/favicon/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="../img/favicon/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="../img/favicon/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="../img/favicon/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="../img/favicon/favicon-128.png" sizes="128x128" />
    <meta name="application-name" content="CodeBaseCamp"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="../img/favicon/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="../img/favicon/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="../img/favicon/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="../img/favicon/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="../img/favicon/mstile-310x310.png" />


    <!-- Canonical URL -->
    <link rel="canonical" href="http://localhost:4000/2016/12/02/Expandable-TableView/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <!-- <link rel="stylesheet" href="/css/hux-blog.min.css"> -->
    <link rel="stylesheet" href="/css/hux-blog.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700,800" rel="stylesheet">

    <!-- Custom Fonts -->
    <!-- <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Code Base Camp</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
                    
                    <li>
                        <a href="/about/">About</a>
                    </li>
                    
                    <li>
                        <a href="/tags/">Tags</a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    var __HuxNav__ = {
        close: function(){
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        },
        open: function(){
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }

    // Bind Event
    $toggle.addEventListener('click', function(e){
        if ($navbar.className.indexOf('in') > 0) {
            __HuxNav__.close()
        }else{
            __HuxNav__.open()
        }
    })

    /**
     * Since Fastclick is used to delegate 'touchstart' globally
     * to hack 300ms delay in iOS by performing a fake 'click',
     * Using 'e.stopPropagation' to stop 'touchstart' event from 
     * $toggle/$collapse will break global delegation.
     * 
     * Instead, we use a 'e.target' filter to prevent handler
     * added to document close HuxNav.  
     *
     * Also, we use 'click' instead of 'touchstart' as compromise
     */
    document.addEventListener('click', function(e){
        if(e.target == $toggle) return;
        if(e.target.className == 'icon-bar') return;
        __HuxNav__.close();
    })
</script>


    <!-- Image to hack wechat -->
<!-- <img src="/img/icon_wechat.png" width="0" height="0"> -->
<!-- <img src="/img/2016-12-02_cover.jpg" width="0" height="0"> -->

<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        position: relative;
        background-image: url('/img/2016-12-02_cover.jpg')
    }

    
    header.intro-header .header-mask{
        width: 100%;
        height: 100%;
        position: absolute;
        background: rgba(0,0,0, 0.5);
    }
    
</style>
<header class="intro-header" >
    <div class="header-mask"></div>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/#iOS" title="iOS">iOS</a>
                        
                        <a class="tag" href="/tags/#Swift" title="Swift">Swift</a>
                        
                    </div>
                    <h1>iOS Expandable Table View Cells</h1>
                    
                    
                    <h2 class="subheading">Expanding TableView Cells using Cell insertion and deletion.</h2>
                    
                    <span class="meta">Posted by Tom on December 2, 2016</span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8
                col-md-10 col-md-offset-1
                post-container">

				<h1 id="overview">Overview</h1>

<p align="center"><iframe src="https://gfycat.com/ifr/MadeupShortFirefly" frameborder="0" scrolling="no" width="320" height="570" style="display:block" allowfullscreen=""></iframe></p>

<p>The following is an implementation for creating an expanding TableView cell effect by insertion and deletion of cells.</p>

<p>There’s many ways to create the appearance of expanding TableView cells, most obviously by increasing the cell’s height to expose overflow contents of the cell. After checking out other methods I decided to go with cell-insertion for my implementation for several reasons:</p>
<ol>
  <li>
    <p>The cell ‘expansion’ has a different appearance to the default cell.</p>
  </li>
  <li>
    <p>Its easier to insert a cell than to stretch an existing cell while maintaining the desired layout constraints.</p>
  </li>
  <li>
    <p>The Expanded cell can be designed separately from the default cell, and dynamically added as an expansion to any cell in the TableView.</p>
  </li>
  <li>
    <p>This method doesn’t explicitly define the state of the cell as ‘expanded’ or ‘contracted’. Little/no additional data needs to be stored for the expanded cells.</p>
  </li>
</ol>

<p>If you’re implementing this in an existing project, <a href="#section_skip">skip the first section</a>.</p>

<p>If you’d like to go straight to the finished project, <a href="#section_download">click here</a>.</p>

<hr />

<h1 id="setting-up">Setting Up</h1>

<p>Open up xCode and create a new Xcode Project. On the project template window, select ‘Single View Application’ and click Next.</p>

<p><img src="http://i.imgur.com/kIEPjTD.png" alt="Screenshot" /></p>

<p>On the project options screen, fill out the ‘Product Name’, ‘Organisation Name’, and ‘Organisation Identifier’ shown below:</p>

<p><img src="http://imgur.com/s6t9PrP.png" alt="Screenshot" /></p>

<p>When the project has been created, open the Main.storyboard file from the Project Navigator. You will be presented with a single blank ViewController.</p>

<p><img src="http://imgur.com/QM8tsAT.png" alt="Screenshot" /></p>

<p>Delete it and drag a new TableViewController into the storyboard from the Object Library.</p>

<p><img src="http://imgur.com/nKKXhUz.png" alt="Screenshot" /></p>

<p>Select the newly created TableViewController from the hierarchy. In the Attributes Inspector, under the ‘View Controller’ category check the ‘Is Initial View Controller’ box.</p>

<p><img src="http://imgur.com/bjh8zmL.png" alt="Screenshot" /></p>

<p>Select the TableView inside the TableViewController from the hierarchy. In the attributes inspector under the ‘TableView’ category increase the ‘Prototype Cells’ property to 2. This will allow us to design the default cell and the expansion cell within the the same TableView.</p>

<p><img src="http://imgur.com/8e2dckt.png" alt="Screenshot" /></p>

<p id="section_skip"></p>

<p>Drag 3 new Swift files from the File Template Library into the project folder.</p>

<p><img src="http://imgur.com/x2t3AjJ.png" alt="Screenshot" /></p>

<p>Name the 3 files ‘DefaultCell.swift’, ‘ExpansionCell.swift’ and ‘ExpandingTVC.swift’ as follows:</p>

<p><img src="http://imgur.com/HDmpVka.png" alt="Screenshot" /></p>

<p>Open the DefaultCell.swift file and enter the following:</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">Foundation</span>
<span class="kd">import</span> <span class="kt">UIKit</span>

<span class="kd">class</span> <span class="kt">DefaultCell</span> <span class="p">:</span> <span class="kt">UITableViewCell</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>
</div>

<p>Next, open the ExpansionCell.swift file and enter:</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">Foundation</span>
<span class="kd">import</span> <span class="kt">UIKit</span>

<span class="kd">class</span> <span class="kt">ExpansionCell</span> <span class="p">:</span> <span class="kt">UITableViewCell</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>
</div>

<p>Finally, in the ExpandingTVC.swift file, enter:</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">Foundation</span>
<span class="kd">import</span> <span class="kt">UIKit</span>

<span class="kd">class</span> <span class="kt">ExpandingTVC</span> <span class="p">:</span> <span class="kt">UITableViewController</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>
</div>

<p>This will allow us to link the classes to the views in the storyboard. We’ll write the full implementation for these later.</p>

<p>Open up the Main.storyboard again and select the first cell in the TableView. In the Identity Inspector, change the custom class to ‘DefaultCell’:</p>

<p><img src="http://imgur.com/We37dQ2.png" alt="Screenshot" /></p>

<p>Do the same for the second cell:</p>

<p><img src="http://imgur.com/I7RfE1l.png" alt="Screenshot" /></p>

<p>And for the TableViewController:</p>

<p><img src="http://imgur.com/3TuBKPk.png" alt="Screenshot" /></p>

<p>Select the Default cell again and change the cell height to 142:</p>

<p><img src="http://imgur.com/pC3BELG.png" alt="Screenshot" /></p>

<p>On the attributes inspector, change the Identifier name to ‘DefaultCell’, and change the background color to black (this will make it easier to see the white text).</p>

<p><img src="http://imgur.com/W2bfJIq.png" alt="Screenshot" /></p>

<p><img src="http://imgur.com/fjZaHsm.png" alt="Screenshot" /></p>

<p>Do the same for the ExpansionCell, setting its Identifier name to ‘ExpansionCell’. Leave the background color of this cell white.</p>

<h1 id="creating-the-table-cells">Creating the Table Cells</h1>

<p>Drag two Text Labels onto the DefaultCell and arrange them roughly as follows:</p>

<p><img src="http://imgur.com/WluFRTl.png" alt="Screenshot" /></p>

<p>The ‘San Francisco’ label is white, with size 40 and style ‘light’. The ‘£425’ label is white, with size 27 and style ‘Black’.</p>

<p>Open the Assistant Editor to view the code next to the storyboard.</p>

<p><img src="http://imgur.com/KVLlNV0.png" alt="Screenshot" /></p>

<p>If the class in the AssistantEditor is not the DefaultCell class, you may need to select it manually, like this:</p>

<p><img src="http://imgur.com/DDcGDyV.png" alt="Screenshot" /></p>

<p>Select the San Francisco Text Label. Holding CTRL, click-and-drag from the Text Label to the class inside the assistant editor. In the popup dialog, set the name of the outlet to ‘DestinationLabel’.</p>

<p><img src="http://imgur.com/DpZd5ua.png" alt="Screenshot" /></p>

<p>Do the same for the ‘£425’ label, naming the outlet to ‘PriceLabel’. Your DefaultCell.swift file should now look like this:</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">DefaultCell</span> <span class="p">:</span> <span class="kt">UITableViewCell</span> <span class="p">{</span>
    <span class="kd">@IBOutlet</span> <span class="k">weak</span> <span class="k">var</span> <span class="nv">DestinationLabel</span><span class="p">:</span> <span class="kt">UILabel</span><span class="o">!</span>
    <span class="kd">@IBOutlet</span> <span class="k">weak</span> <span class="k">var</span> <span class="nv">PriceLabel</span><span class="p">:</span> <span class="kt">UILabel</span><span class="o">!</span>

<span class="p">}</span>
</code></pre>
</div>

<p>Moving on to the ExpansionCell, drag a new ImageView component from the object library and position it inside the ExpansionCell.</p>

<p><img src="http://imgur.com/docONIO.png" alt="Screenshot" /></p>

<p>On the ImageView attributes change the image to the flight-icon imported earlier.</p>

<p><img src="http://imgur.com/ujiZ9ry.png" alt="Screenshot" /></p>

<p>Add two Labels to the ExpansionCell with size 32, positioned approximately like this:</p>

<p><img src="http://imgur.com/CcjHChg.png" alt="Screenshot" /></p>

<p>Now things are starting to take shape!</p>

<p>Again we need to link the two labels ‘MAN’ and ‘CFO’ to the corresponding class. Select the ExpansionCell from the hierarchy and open the Assistant Editor. Make sure that the ExpansionCell class is open. As with the DefaultCell, hold CTRL and click-and-drag from the label in the storyboard to the class file. The outlet for label ‘MAN’ is StartLabel, and the outlet for label ‘CFO’ is EndLabel. Your <code class="highlighter-rouge">ExpansionCell</code> class should now look like this:</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">ExpansionCell</span> <span class="p">:</span> <span class="kt">UITableViewCell</span> <span class="p">{</span>
    <span class="kd">@IBOutlet</span> <span class="k">weak</span> <span class="k">var</span> <span class="nv">StartLabel</span><span class="p">:</span> <span class="kt">UILabel</span><span class="o">!</span>
    <span class="kd">@IBOutlet</span> <span class="k">weak</span> <span class="k">var</span> <span class="nv">EndLabel</span><span class="p">:</span> <span class="kt">UILabel</span><span class="o">!</span>
<span class="p">}</span>
</code></pre>
</div>

<h2 id="defining-the-data">Defining the Data</h2>

<p>Next, we need to lay a bit of ground-work for our data. We need to store information for each destination shown in the <code class="highlighter-rouge">TableView</code>. Each destination needs a:</p>
<ul>
  <li>Name</li>
  <li>Price</li>
  <li>Image Name</li>
  <li>List of Flights</li>
</ul>

<p>Each flight in the list needs a start point and an end point. To set this up, create a new Swift file in the project called DestinationData.swift. Insert the following code into the file:</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">Foundation</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="kt">DestinationData</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">price</span><span class="p">:</span> <span class="kt">String</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">imageName</span><span class="p">:</span> <span class="kt">String</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">flights</span><span class="p">:</span> <span class="p">[</span><span class="kt">FlightData</span><span class="p">]?</span>

    <span class="nf">init</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">price</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">imageName</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">flights</span><span class="p">:</span> <span class="p">[</span><span class="kt">FlightData</span><span class="p">]?)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">self</span><span class="o">.</span><span class="n">price</span> <span class="o">=</span> <span class="n">price</span>
        <span class="k">self</span><span class="o">.</span><span class="n">imageName</span> <span class="o">=</span> <span class="n">imageName</span>
        <span class="k">self</span><span class="o">.</span><span class="n">flights</span> <span class="o">=</span> <span class="n">flights</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="kt">FlightData</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">start</span><span class="p">:</span> <span class="kt">String</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">end</span><span class="p">:</span> <span class="kt">String</span>

    <span class="nf">init</span><span class="p">(</span><span class="nv">start</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">end</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span>
        <span class="k">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">end</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>As a brief explanation of whats happening here, each destination is stored in an instance of the <code class="highlighter-rouge">DestinationData</code> class. Each flight, represented by the ExpansionCell, is stored in the <code class="highlighter-rouge">flightData</code> class. Each destination stores multiple flights in an array. The array of flights is optional, denoted by the ?. This is to demonstrate the case where some cells will not expand (as they have no flights available).</p>

<p>Now we can move on to setting up the <code class="highlighter-rouge">TableViewController</code>.</p>

<h1 id="setting-up-the-table">Setting up the Table</h1>

<p>Open the <code class="highlighter-rouge">ExpandingTVC</code> class and create the following function for generating some destination data:</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="kd">private</span> <span class="kd">func</span> <span class="nf">getData</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">DestinationData</span><span class="p">?]</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nv">data</span><span class="p">:</span> <span class="p">[</span><span class="kt">DestinationData</span><span class="p">?]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">let</span> <span class="nv">sanFranciscoFlights</span> <span class="o">=</span> <span class="p">[</span><span class="kt">FlightData</span><span class="p">(</span><span class="nv">start</span><span class="p">:</span> <span class="s">"MAN"</span><span class="p">,</span> <span class="nv">end</span><span class="p">:</span> <span class="s">"CFO"</span><span class="p">)]</span>
        <span class="k">let</span> <span class="nv">sanFrancisco</span> <span class="o">=</span> <span class="kt">DestinationData</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"San Francisco"</span><span class="p">,</span> <span class="nv">price</span><span class="p">:</span> <span class="s">"£425"</span><span class="p">,</span> <span class="nv">imageName</span><span class="p">:</span> <span class="s">"san_francisco-banner"</span><span class="p">,</span> <span class="nv">flights</span><span class="p">:</span> <span class="n">sanFranciscoFlights</span><span class="p">)</span>

        <span class="k">let</span> <span class="nv">londonFlights</span> <span class="o">=</span> <span class="p">[</span><span class="kt">FlightData</span><span class="p">(</span><span class="nv">start</span><span class="p">:</span> <span class="s">"MAN"</span><span class="p">,</span> <span class="nv">end</span><span class="p">:</span> <span class="s">"LHR"</span><span class="p">),</span> <span class="kt">FlightData</span><span class="p">(</span><span class="nv">start</span><span class="p">:</span> <span class="s">"MAN"</span><span class="p">,</span> <span class="nv">end</span><span class="p">:</span> <span class="s">"LCY"</span><span class="p">)]</span>
        <span class="k">let</span> <span class="nv">london</span> <span class="o">=</span> <span class="kt">DestinationData</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"London"</span><span class="p">,</span> <span class="nv">price</span><span class="p">:</span> <span class="s">"£500"</span><span class="p">,</span> <span class="nv">imageName</span><span class="p">:</span> <span class="s">"london-banner"</span><span class="p">,</span> <span class="nv">flights</span><span class="p">:</span> <span class="n">londonFlights</span><span class="p">)</span>

        <span class="k">let</span> <span class="nv">newYork</span> <span class="o">=</span> <span class="kt">DestinationData</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"New York"</span><span class="p">,</span> <span class="nv">price</span><span class="p">:</span> <span class="s">"630"</span><span class="p">,</span> <span class="nv">imageName</span><span class="p">:</span> <span class="s">"new_york-banner"</span><span class="p">,</span> <span class="nv">flights</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">sanFrancisco</span><span class="p">,</span> <span class="n">london</span><span class="p">,</span> <span class="n">newYork</span><span class="p">]</span>
    <span class="p">}</span>
</code></pre>
</div>
<p>Here we create 3 destinations: San Francisco, London and New York. San Francisco has 1 flight, London has 2, and New York has 0, and so will not expand.</p>

<p>Before the newly-created <code class="highlighter-rouge">getData()</code> function, add a variable <code class="highlighter-rouge">DestinationData</code> and override the <code class="highlighter-rouge">viewDidLoad</code> function, as follows:</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="k">var</span> <span class="nv">destinationData</span><span class="p">:</span> <span class="p">[</span><span class="kt">DestinationData</span><span class="p">?]?</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">destinationData</span> <span class="o">=</span> <span class="nf">getData</span><span class="p">()</span>
        <span class="n">tableView</span><span class="o">.</span><span class="n">rowHeight</span> <span class="o">=</span> <span class="kt">UITableViewAutomaticDimension</span><span class="p">;</span>
    <span class="p">}</span>
</code></pre>
</div>
<p>This will store the <code class="highlighter-rouge">destinationData</code> in the <code class="highlighter-rouge">TableViewController</code> and allow the <code class="highlighter-rouge">TableView</code> rows to automatically set their height. Note that both the <code class="highlighter-rouge">destinationData</code> array, and the contents of the array are optional. This is to allow us to insert <code class="highlighter-rouge">nil</code> values into the array, to represent the location of expanded cells in the TableView.</p>

<p>Next, override the <code class="highlighter-rouge">tableView</code> function for specifying the number of rows, as shown below:</p>
<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="cm">/*  Number of Rows  */</span>
<span class="k">override</span> <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">numberOfRowsInSection</span> <span class="nv">section</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Int</span> <span class="p">{</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="n">destinationData</span> <span class="p">{</span>
          <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">count</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">return</span> <span class="mi">0</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre>
</div>

<h2 id="displaying-cells">Displaying Cells</h2>

<p>To tell the <code class="highlighter-rouge">TableView</code> which cell to use, and to populate it with data, we next override the following function:</p>
<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="cm">/*  Create Cells    */</span>
    <span class="k">override</span> <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">cellForRowAt</span> <span class="nv">indexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UITableViewCell</span> <span class="p">{</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>To track where we put expanded cells in the <code class="highlighter-rouge">TableView</code>, we’re going to insert <code class="highlighter-rouge">nil</code> entries into the <code class="highlighter-rouge">destinationData</code> array. So first we need to check if the cell being created is a <code class="highlighter-rouge">DefaultCell</code> or an <code class="highlighter-rouge">ExpansionCell</code>. This is easily accomplished by checking if the index in the array is nil or not:</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="k">override</span> <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">cellForRowAt</span> <span class="nv">indexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UITableViewCell</span> <span class="p">{</span>
    <span class="c1">// Row is DefaultCell</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">rowData</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">indexPath</span><span class="o">.</span><span class="n">row</span><span class="p">]</span> <span class="p">{</span>
      <span class="k">let</span> <span class="nv">defaultCell</span> <span class="o">=</span> <span class="n">tableView</span><span class="o">.</span><span class="nf">dequeueReusableCell</span><span class="p">(</span><span class="nv">withIdentifier</span><span class="p">:</span> <span class="s">"DefaultCell"</span><span class="p">,</span> <span class="nv">for</span><span class="p">:</span> <span class="n">indexPath</span><span class="p">)</span> <span class="k">as!</span> <span class="kt">DefaultCell</span>
                  <span class="n">defaultCell</span><span class="o">.</span><span class="kt">DestinationLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">rowData</span><span class="o">.</span><span class="n">name</span>
                  <span class="n">defaultCell</span><span class="o">.</span><span class="kt">PriceLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">rowData</span><span class="o">.</span><span class="n">price</span>
                  <span class="n">defaultCell</span><span class="o">.</span><span class="n">backgroundView</span> <span class="o">=</span> <span class="kt">UIImageView</span><span class="p">(</span><span class="nv">image</span><span class="p">:</span> <span class="kt">UIImage</span><span class="p">(</span><span class="nv">named</span><span class="p">:</span> <span class="n">rowData</span><span class="o">.</span><span class="n">imageName</span><span class="p">))</span>
                  <span class="n">defaultCell</span><span class="o">.</span><span class="n">selectionStyle</span> <span class="o">=</span> <span class="o">.</span><span class="k">none</span>
                  <span class="k">return</span> <span class="n">defaultCell</span>
    <span class="p">}</span>
    <span class="c1">// Row is ExpansionCell</span>
    <span class="k">else</span> <span class="p">{</span>

    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>If the row is a <code class="highlighter-rouge">DefaultCell</code>, the cell is dequeued using the ‘DefaultCell’ identifier, and the destination name, price, and background image are set.</p>

<p>Next we need to set the data for an expansion cell. As mentioned earlier, an expansion cell is represented by a <code class="highlighter-rouge">nil</code> entry in the <code class="highlighter-rouge">destinationData</code> array, therefore we need to find which data is associated with the <code class="highlighter-rouge">nil</code> entry. One option is to get the cell before the expansion, and use its data to populate the <code class="highlighter-rouge">ExpansionCell</code>. This solution works for 1 <code class="highlighter-rouge">ExpansionCell</code>, but if there are multiple <code class="highlighter-rouge">ExpansionCell</code>s, then the cell above the current cell may also be nil:</p>

<p><img src="http://imgur.com/iqiA6IZ.png" alt="Screenshot" /></p>

<p>To get the ‘parent’ cell we need to go up the chain of cells until we find one that is not nil. This is accomplished by the following function. Put this function in the <code class="highlighter-rouge">ExpandingTVC</code> class to find the parent cell:</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="cm">/*  Get parent cell for selected ExpansionCell  */</span>
    <span class="kd">private</span> <span class="kd">func</span> <span class="nf">getParentCellIndex</span><span class="p">(</span><span class="nv">expansionIndex</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Int</span> <span class="p">{</span>

        <span class="k">var</span> <span class="nv">selectedCell</span><span class="p">:</span> <span class="kt">DestinationData</span><span class="p">?</span>
        <span class="k">var</span> <span class="nv">selectedCellIndex</span> <span class="o">=</span> <span class="n">expansionIndex</span>

        <span class="k">while</span><span class="p">(</span><span class="n">selectedCell</span> <span class="o">==</span> <span class="kc">nil</span> <span class="o">&amp;&amp;</span> <span class="n">selectedCellIndex</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">selectedCellIndex</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">selectedCell</span> <span class="o">=</span> <span class="n">destinationData</span><span class="p">?[</span><span class="n">selectedCellIndex</span><span class="p">]</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">selectedCellIndex</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>With this utility method, we can go ahead and implement the creation of <code class="highlighter-rouge">ExpansionCell</code>s. Back in the <code class="highlighter-rouge">tableView(... cellForRowAt ...)</code> function, insert the following inside the else parentheses:</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="c1">// Row is ExpansionCell</span>
<span class="k">else</span> <span class="p">{</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">rowData</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="nf">getParentCellIndex</span><span class="p">(</span><span class="nv">expansionIndex</span><span class="p">:</span> <span class="n">indexPath</span><span class="o">.</span><span class="n">row</span><span class="p">)]</span> <span class="p">{</span>
        <span class="c1">//  Create an ExpansionCell</span>
        <span class="k">let</span> <span class="nv">expansionCell</span> <span class="o">=</span> <span class="n">tableView</span><span class="o">.</span><span class="nf">dequeueReusableCell</span><span class="p">(</span><span class="nv">withIdentifier</span><span class="p">:</span> <span class="s">"ExpansionCell"</span><span class="p">,</span> <span class="nv">for</span><span class="p">:</span> <span class="n">indexPath</span><span class="p">)</span> <span class="k">as!</span> <span class="kt">ExpansionCell</span>

        <span class="c1">//  Get the index of the parent Cell (containing the data)</span>
        <span class="k">let</span> <span class="nv">parentCellIndex</span> <span class="o">=</span> <span class="nf">getParentCellIndex</span><span class="p">(</span><span class="nv">expansionIndex</span><span class="p">:</span> <span class="n">indexPath</span><span class="o">.</span><span class="n">row</span><span class="p">)</span>

        <span class="c1">//  Get the index of the flight data (e.g. if there are multiple ExpansionCells</span>
        <span class="k">let</span> <span class="nv">flightIndex</span> <span class="o">=</span> <span class="n">indexPath</span><span class="o">.</span><span class="n">row</span> <span class="o">-</span> <span class="n">parentCellIndex</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="c1">//  Set the cell's data</span>
        <span class="n">expansionCell</span><span class="o">.</span><span class="kt">StartLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">rowData</span><span class="o">.</span><span class="n">flights</span><span class="p">?[</span><span class="n">flightIndex</span><span class="p">]</span><span class="o">.</span><span class="n">start</span>
        <span class="n">expansionCell</span><span class="o">.</span><span class="kt">EndLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">rowData</span><span class="o">.</span><span class="n">flights</span><span class="p">?[</span><span class="n">flightIndex</span><span class="p">]</span><span class="o">.</span><span class="n">end</span>
        <span class="n">expansionCell</span><span class="o">.</span><span class="n">selectionStyle</span> <span class="o">=</span> <span class="o">.</span><span class="k">none</span>
        <span class="k">return</span> <span class="n">expansionCell</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre>
</div>

<p>First we dequeue an <code class="highlighter-rouge">ExpansionCell</code> using the identifier defined earlier. We then get the index of the parent cell using the <code class="highlighter-rouge">getParentCellIndex()</code> function. Next, we need to get the index of the flight data that will be displayed in THIS <code class="highlighter-rouge">ExpansionCell</code>. We get this from subtracting the index of THIS <code class="highlighter-rouge">ExpansionCell</code> from the index of the parent <code class="highlighter-rouge">DefaultCell</code>. We subtract a further 1 to ensure the index starts at 0. Finally we set the cell’s data and return it.</p>

<p>Your tableView(… cellForRowAt …) method should now look like this:</p>
<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="cm">/*  Create Cells    */</span>
    <span class="k">override</span> <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">cellForRowAt</span> <span class="nv">indexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UITableViewCell</span> <span class="p">{</span>
        <span class="c1">// Row is DefaultCell</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">rowData</span> <span class="o">=</span> <span class="n">destinationData</span><span class="p">?[</span><span class="n">indexPath</span><span class="o">.</span><span class="n">row</span><span class="p">]</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">defaultCell</span> <span class="o">=</span> <span class="n">tableView</span><span class="o">.</span><span class="nf">dequeueReusableCell</span><span class="p">(</span><span class="nv">withIdentifier</span><span class="p">:</span> <span class="s">"DefaultCell"</span><span class="p">,</span> <span class="nv">for</span><span class="p">:</span> <span class="n">indexPath</span><span class="p">)</span> <span class="k">as!</span> <span class="kt">DefaultCell</span>
            <span class="n">defaultCell</span><span class="o">.</span><span class="kt">DestinationLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">rowData</span><span class="o">.</span><span class="n">name</span>
            <span class="n">defaultCell</span><span class="o">.</span><span class="kt">PriceLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">rowData</span><span class="o">.</span><span class="n">price</span>
            <span class="n">defaultCell</span><span class="o">.</span><span class="n">backgroundView</span> <span class="o">=</span> <span class="kt">UIImageView</span><span class="p">(</span><span class="nv">image</span><span class="p">:</span> <span class="kt">UIImage</span><span class="p">(</span><span class="nv">named</span><span class="p">:</span> <span class="n">rowData</span><span class="o">.</span><span class="n">imageName</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">defaultCell</span>
        <span class="p">}</span>
        <span class="c1">// Row is ExpansionCell</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">rowData</span> <span class="o">=</span> <span class="n">destinationData</span><span class="p">?[</span><span class="nf">getParentCellIndex</span><span class="p">(</span><span class="nv">expansionIndex</span><span class="p">:</span> <span class="n">indexPath</span><span class="o">.</span><span class="n">row</span><span class="p">)]</span> <span class="p">{</span>
                <span class="c1">//  Create an ExpansionCell</span>
                <span class="k">let</span> <span class="nv">expansionCell</span> <span class="o">=</span> <span class="n">tableView</span><span class="o">.</span><span class="nf">dequeueReusableCell</span><span class="p">(</span><span class="nv">withIdentifier</span><span class="p">:</span> <span class="s">"ExpansionCell"</span><span class="p">,</span> <span class="nv">for</span><span class="p">:</span> <span class="n">indexPath</span><span class="p">)</span> <span class="k">as!</span> <span class="kt">ExpansionCell</span>

                <span class="c1">//  Get the index of the parent Cell (containing the data)</span>
                <span class="k">let</span> <span class="nv">parentCellIndex</span> <span class="o">=</span> <span class="nf">getParentCellIndex</span><span class="p">(</span><span class="nv">expansionIndex</span><span class="p">:</span> <span class="n">indexPath</span><span class="o">.</span><span class="n">row</span><span class="p">)</span>

                <span class="c1">//  Get the index of the flight data (e.g. if there are multiple ExpansionCells</span>
                <span class="k">let</span> <span class="nv">flightIndex</span> <span class="o">=</span> <span class="n">indexPath</span><span class="o">.</span><span class="n">row</span> <span class="o">-</span> <span class="n">parentCellIndex</span> <span class="o">-</span> <span class="mi">1</span>

                <span class="c1">//  Set the cell's data</span>
                <span class="n">expansionCell</span><span class="o">.</span><span class="kt">StartLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">rowData</span><span class="o">.</span><span class="n">flights</span><span class="p">?[</span><span class="n">flightIndex</span><span class="p">]</span><span class="o">.</span><span class="n">start</span>
                <span class="n">expansionCell</span><span class="o">.</span><span class="kt">EndLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">rowData</span><span class="o">.</span><span class="n">flights</span><span class="p">?[</span><span class="n">flightIndex</span><span class="p">]</span><span class="o">.</span><span class="n">end</span>

                <span class="k">return</span> <span class="n">expansionCell</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kt">UITableViewCell</span><span class="p">()</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>We also need to tell the <code class="highlighter-rouge">TableView</code> what height to use for the different types of cells. The following function does this:</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="k">override</span> <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">heightForRowAt</span> <span class="nv">indexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">CGFloat</span> <span class="p">{</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">rowData</span> <span class="o">=</span> <span class="n">destinationData</span><span class="p">?[</span><span class="n">indexPath</span><span class="o">.</span><span class="n">row</span><span class="p">]</span> <span class="p">{</span>
            <span class="k">return</span> <span class="mi">142</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="mi">75</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre>
</div>

<h1 id="expanding-and-contracting-cells">Expanding and Contracting Cells</h1>

<p>To make the code a bit clearer, we’re going to split up the logic for expanding and contracting cells. This will require 2 function: <code class="highlighter-rouge">expandCell()</code> and <code class="highlighter-rouge">contractCell()</code>.</p>

<p>For the expanding the cell, create the following function:</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="kd">private</span> <span class="kd">func</span> <span class="nf">expandCell</span><span class="p">(</span><span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="nv">index</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Expand Cell (add ExpansionCells</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">flights</span> <span class="o">=</span> <span class="n">destinationData</span><span class="p">?[</span><span class="n">index</span><span class="p">]?</span><span class="o">.</span><span class="n">flights</span> <span class="p">{</span>
            <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">1</span><span class="o">...</span><span class="n">flights</span><span class="o">.</span><span class="n">count</span> <span class="p">{</span>
                <span class="n">destinationData</span><span class="p">?</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="kc">nil</span><span class="p">,</span> <span class="nv">at</span><span class="p">:</span> <span class="n">index</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span>
                <span class="n">tableView</span><span class="o">.</span><span class="nf">insertRows</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="p">[</span><span class="kt">NSIndexPath</span><span class="p">(</span><span class="nv">row</span><span class="p">:</span> <span class="n">index</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="nv">section</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span> <span class="k">as</span> <span class="kt">IndexPath</span><span class="p">]</span> <span class="p">,</span> <span class="nv">with</span><span class="p">:</span> <span class="o">.</span><span class="n">top</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>In the above code, we first check if the cell to be expanded has any flights stored. If it does, the for-loop proceeds through each flight, inserting nil into the <code class="highlighter-rouge">destinationData</code> array (to represent the location of an <code class="highlighter-rouge">ExpansionCell</code>), and calls the <code class="highlighter-rouge">tableView.InsertRows()</code> function. In the <code class="highlighter-rouge">insertRows()</code> function we pass the index where we want to insert a row, and the animation to use. We’re using the <code class="highlighter-rouge">.top</code> animation for this, as it ‘pull-down’ the new cell from the one above it, giving the illusion of the cell expanding from under the above cell.</p>

<p>For contracting a cell, insert the following function into the <code class="highlighter-rouge">ExpandingTVC</code> class:</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="kd">private</span> <span class="kd">func</span> <span class="nf">contractCell</span><span class="p">(</span><span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="nv">index</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">flights</span> <span class="o">=</span> <span class="n">destinationData</span><span class="p">?[</span><span class="n">index</span><span class="p">]?</span><span class="o">.</span><span class="n">flights</span> <span class="p">{</span>
            <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">1</span><span class="o">...</span><span class="n">flights</span><span class="o">.</span><span class="n">count</span> <span class="p">{</span>
                <span class="n">destinationData</span><span class="p">?</span><span class="o">.</span><span class="nf">remove</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">tableView</span><span class="o">.</span><span class="nf">deleteRows</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="p">[</span><span class="kt">NSIndexPath</span><span class="p">(</span><span class="nv">row</span><span class="p">:</span> <span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nv">section</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span> <span class="k">as</span> <span class="kt">IndexPath</span><span class="p">],</span> <span class="nv">with</span><span class="p">:</span> <span class="o">.</span><span class="n">top</span><span class="p">)</span>

            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>this function works similarly to the <code class="highlighter-rouge">expandCell()</code> function, but instead deletes entries from the <code class="highlighter-rouge">destinationData</code> array and removes rows from the table. This also uses the <code class="highlighter-rouge">.top</code> animation to show the removed cell sliding up under the above cell.</p>

<h1 id="selecting-cells">Selecting Cells</h1>

<p>Finally we connect our logic to the <code class="highlighter-rouge">tableView(... didSelectCell...)</code> method, for when a user clicks on a cell. First we define the function and then check if the user clicked on a <code class="highlighter-rouge">DefaultCell</code>. (For the purposes of this tutorial, we’re only expanding/contracting cells when the user clicks on the ‘parent’ <code class="highlighter-rouge">DefaultCell</code> - nothing happens when the user clicks on an ExpansionCell):</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="k">override</span> <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">didSelectRowAt</span> <span class="nv">indexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="n">destinationData</span><span class="p">?[</span><span class="n">indexPath</span><span class="o">.</span><span class="n">row</span><span class="p">]</span> <span class="p">{</span>
</code></pre>
</div>

<p>The next bit gets a bit complicated. We need to see if the cell below the selected cell is <code class="highlighter-rouge">nil</code> or not, to check if the current cell is expanded. If the current cell is the last cell in the array, when we try to access the cell at indexPath.row + 1, we’ll get an ‘Array Index out of Range’ error. So first we check if this is the last cell in the array:</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="k">override</span> <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">didSelectRowAt</span> <span class="nv">indexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="n">destinationData</span><span class="p">?[</span><span class="n">indexPath</span><span class="o">.</span><span class="n">row</span><span class="p">]</span> <span class="p">{</span>

            <span class="c1">// If user clicked last cell, do not try to access cell+1 (out of range)</span>
            <span class="k">if</span><span class="p">(</span><span class="n">indexPath</span><span class="o">.</span><span class="n">row</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">destinationData</span><span class="p">?</span><span class="o">.</span><span class="n">count</span><span class="p">)</span><span class="o">!</span><span class="p">)</span> <span class="p">{</span>
                <span class="nf">expandCell</span><span class="p">(</span><span class="nv">tableView</span><span class="p">:</span> <span class="n">tableView</span><span class="p">,</span> <span class="nv">index</span><span class="p">:</span> <span class="n">indexPath</span><span class="o">.</span><span class="n">row</span><span class="p">)</span>
            <span class="p">}</span>
</code></pre>
</div>

<p>If the user DOES click the last cell, then the only option is to expand it, so we call the <code class="highlighter-rouge">expandCell()</code> function defined earlier. Now that this dodgy edge-case is taken care of, we can easily check the next cell below the current one:</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="k">override</span> <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">didSelectRowAt</span> <span class="nv">indexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="n">destinationData</span><span class="p">?[</span><span class="n">indexPath</span><span class="o">.</span><span class="n">row</span><span class="p">]</span> <span class="p">{</span>

            <span class="c1">// If user clicked last cell, do not try to access cell+1 (out of range)</span>
            <span class="k">if</span><span class="p">(</span><span class="n">indexPath</span><span class="o">.</span><span class="n">row</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">destinationData</span><span class="p">?</span><span class="o">.</span><span class="n">count</span><span class="p">)</span><span class="o">!</span><span class="p">)</span> <span class="p">{</span>
                <span class="nf">expandCell</span><span class="p">(</span><span class="nv">tableView</span><span class="p">:</span> <span class="n">tableView</span><span class="p">,</span> <span class="nv">index</span><span class="p">:</span> <span class="n">indexPath</span><span class="o">.</span><span class="n">row</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span>
                <span class="c1">// If next cell is not nil, then cell is not expanded</span>
                <span class="k">if</span><span class="p">(</span><span class="n">destinationData</span><span class="p">?[</span><span class="n">indexPath</span><span class="o">.</span><span class="n">row</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">nil</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nf">expandCell</span><span class="p">(</span><span class="nv">tableView</span><span class="p">:</span> <span class="n">tableView</span><span class="p">,</span> <span class="nv">index</span><span class="p">:</span> <span class="n">indexPath</span><span class="o">.</span><span class="n">row</span><span class="p">)</span>
                <span class="c1">// Close Cell (remove ExpansionCells)</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nf">contractCell</span><span class="p">(</span><span class="nv">tableView</span><span class="p">:</span> <span class="n">tableView</span><span class="p">,</span> <span class="nv">index</span><span class="p">:</span> <span class="n">indexPath</span><span class="o">.</span><span class="n">row</span><span class="p">)</span>

                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>And thats it! Run the code and you should now be able to expand cells 1 and 2.</p>

<hr />

<h1 id="download---github">Download - Github</h1>

<p id="section_download"></p>

<p>The full source code for the project can be found on Github at:</p>

<p><a href="https://github.com/codebasecampprojects/Expanding-TableView/tree/master">https://github.com/codebasecampprojects/Expanding-TableView</a></p>

<p>—— Tom 2015.11</p>


                <hr style="visibility: hidden;">

                


                <ul class="pager">
                    
                    
                    <li class="next">
                        <a href="/2017/01/08/Working-With-Classes-in-Javascript/" data-toggle="tooltip" data-placement="top" title="Classes and Events in node.js">
                        Next<br>
                        <span>Classes and Events in node.js</span>
                        </a>
                    </li>
                    
                </ul>


                

                
                <!-- disqus 评论框 start -->
                <div class="comment">
                    <div id="disqus_thread" class="disqus-thread"></div>
                </div>
                <!-- disqus 评论框 end -->
                

            </div>

    

    <!-- Side Catalog Container -->
        
            <div class="
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                <div class="side-catalog">
                    <hr class="hidden-sm hidden-xs">
                    <h5>
                        <a class="catalog-toggle" href="#">SECTION</a>
                    </h5>
                    <ul class="catalog-body"></ul>
                </div>
            </div>
        

    <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
        				
                            
        				
                            
        				
                            
                				<a href="/tags/#Javascript" title="Javascript" rel="2">
                                    Javascript
                                </a>
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
        			</div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">
                    
                        <li><a href="http://www.hypnosstudios.com/">Hypnos Studios</a></li>
                    
                </ul>
                
            </div>
        </div>
    </div>
</article>






<!-- disqus 公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = "code-base-camp";
    var disqus_identifier = "/2016/12/02/Expandable-TableView";
    var disqus_url = "http://localhost:4000/2016/12/02/Expandable-TableView/";

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<!-- disqus 公共JS代码 end -->




<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'always',
          placement: 'right',
          icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    
                    

                    <!-- add Weibo, Zhihu by Hux, add target = "_blank" to <a> by Hux -->
                    
                    


                    
                    
                    <li>
                        <a target="_blank" href="https://github.com/tjw0051">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; Code Base Camp 2017
                    <br>
                    Theme by <a href="http://huangxuan.me">Hux</a> |
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="91px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=huxpro&repo=huxpro.github.io&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js "></script>

<!-- Service Worker -->

<script type="text/javascript">
    if(navigator.serviceWorker){
        // For security reasons, a service worker can only control the pages that are in the same directory level or below it. That's why we put sw.js at ROOT level.
        navigator.serviceWorker
            .register('/sw.js')
            .then((registration) => {console.log('Service Worker Registered. ', registration)})
            .catch((error) => {console.log('ServiceWorker registration failed: ', error)})
    }
</script>



<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/ 
     - https://github.com/jneen/rouge/wiki/list-of-supported-languages-and-lexers   
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async('/js/jquery.tagcloud.js',function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->

<script>
    // dynamic User by Hux
    var _gaId = 'UA-86516015-1';
    var _gaDomain = 'codebasecamp.com';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>



<!-- Baidu Tongji -->




<!-- Side Catalog -->

<script type="text/javascript">
    function generateCatalog (selector) {
        var P = $('div.post-container'),a,n,t,l,i,c;
        a = P.find('h1,h2,h3,h4,h5,h6');
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#"+$(this).prop('id');
            t = $(this).text();
            c = $('<a href="'+i+'" rel="nofollow">'+t+'</a>');
            l = $('<li class="'+n+'_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;    
    }

    generateCatalog(".catalog-body");

    // toggle side catalog
    $(".catalog-toggle").click((function(e){
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    /*
     * Doc: https://github.com/davist11/jQuery-One-Page-Nav
     * Fork by Hux to support padding
     */
    async("/js/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>





<!-- Image to hack wechat -->
<img src="/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
